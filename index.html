<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aruns E-Services Portal (with GitHub Backup)</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:"Segoe UI",Arial,sans-serif;background:#f0f4fb;color:#333;height:100vh;}
    #loginPage{display:flex;justify-content:center;align-items:center;height:100vh;background:linear-gradient(120deg,#cfd6dd,#d5e0e9);}    
    .login-box{background:#fff;padding:30px;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,0.3);width:320px;text-align:center;}
    .login-box h2{margin-bottom:15px;color:#003366;}
    .login-box input{width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:5px;}
    .login-box button{width:100%;padding:10px;background:#003366;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:16px;}
    .login-box button:hover{background:#0055aa;}
    .error-msg{color:red;font-size:13px;display:none;}
    #mainPage{display:none;height:100vh;overflow:hidden;}
    header{background:linear-gradient(90deg,#002b5c,#004b8d);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:8px 20px;}
    header img{height:60px;}
    header .title{text-align:center;flex-grow:1;}
    header .title h1{font-size:22px;}
    .container{display:grid;grid-template-columns:250px 1fr;height:calc(100vh - 75px);}    
    .sidebar{background:#e9eff7;border-right:2px solid #c3cbe0;padding:10px;overflow-y:auto;}
    .sidebar h3{color:#003366;margin-bottom:10px;}
    .folder>div{cursor:pointer;padding:6px 10px;border-radius:4px;display:flex;align-items:center;}
    .folder ul{margin-left:20px;margin-top:5px;list-style:none;display:none;}
    .folder.open>ul{display:block;}
    .folder ul li a{text-decoration:none;color:#003366;display:block;padding:4px 8px;border-radius:4px;}
    .folder ul li a:hover{background:#c7d7f0;}    
    main{background:#fff;}    
    iframe{width:100%;height:100%;border:none;}    
    footer{background:#002b5c;color:#fff;text-align:center;font-size:12px;padding:6px;}    
    .time-box{
      display:flex;flex-direction:column;align-items:center;padding:6px 15px;border-radius:12px;
      background:linear-gradient(135deg,#003366,#0077cc);
      border:2px solid #00ffff;
      box-shadow:0 0 15px rgba(0,255,255,0.5);
      animation:pulse 3s infinite ease-in-out;
    }
    @keyframes pulse{
      0%{box-shadow:0 0 10px rgba(0,255,255,0.4);}      
      50%{box-shadow:0 0 25px rgba(0,255,255,0.9);}      
      100%{box-shadow:0 0 10px rgba(0,255,255,0.4);}    
    }
    .time-box .eng{font-size:15px;color:#aee2ff;}
    .time-box .nep{font-size:14px;color:#ffea91;font-weight:600;}
  </style>
</head>
<body>

<div id="loginPage">
  <div class="login-box">
    <h2> ğ‹ğ¨ğ  ğˆğ§ Ê•Ê˜Ì…ÍœÊ˜Ì…Ê” ğŸ”</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <div class="error-msg" id="error"> ğˆğ§ğ¯ğšğ¥ğ¢ğ ğ”ğ¬ğğ«ğ§ğšğ¦ğ ğ¨ğ« ğğšğ¬ğ¬ğ°ğ¨ğ«ğ âŒ</div>
    <button onclick="login()">Login</button>
    <p style="font-size:12px;margin-top:10px;">Please Use Correct Info To Login <b></b>...... <b></b></p>
  </div>
</div>

<div id="mainPage">
  <header>
    <div style="display:flex;align-items:center;gap:10px;">
      <img src="https://upload.wikimedia.org/wikipedia/commons/a/a9/Animated-nepal-flag-image-0007.gif" alt="Nepal Flag">
      <div class="time-box">
        <div class="eng" id="engTime">Loading...</div>
        <div class="nep" id="nepTime">à¤¨à¥‡à¤ªà¤¾à¤²à¥€ à¤®à¤¿à¤¤à¤¿...</div>
      </div>
    </div>
    <div class="title">
     
      <h1> â²¯ï¹ï¸¿ï¹ï¸¿ï¹ ğ“¦ğ“®ğ“µğ“¬ğ“¸ğ“¶ğ“® ï¹â²¯ï¹â²¯ï¹ï¸¿ï¹â˜¼ </h1>
      <p> ğƒğšğ­ğšğ›ğšğ¬ğ ğ–ğ¢ğ­ğ¡ ğ‚ğ¥ğ¨ğ®ğ ğƒğğ©ğšğ«ğ­ğ¦ğğ§ğ­, ğ†ğ¨ğ¯ğğ«ğ§ğ¦ğğ§ğ­ ğ¨ğŸ ğğğ©ğšğ¥</p>
    </div>
     <img src="https://upload.wikimedia.org/wikipedia/commons/1/18/Small_wifi_reverse_signal.gif" alt="IRD Logo" onerror="this.style.display='none'">
    <img src="https://upload.wikimedia.org/wikipedia/commons/b/b9/Small_gif.gif" alt="IRD Logo" onerror="this.style.display='none'">
    
  </header>

  <div class="container">
    <div class="sidebar">
      <h3>ğğ§ğ¥ğ¢ğ§ğ ğ„-ğ’ğğ«ğ¯ğ¢ğœğğ¬</h3>
      <div class="folder">
        <div onclick="toggleFolder(this)">ğŸ“ ğ€ğ›ğ¨ğ®ğ­-ğšğğ¦ğ¢ğ§</div>
        <ul>
          <li><a href="https://dreamwaver2020.github.io/Boost-nepal/" target="contentFrame">ğŸ— General</a></li>
          <li><a href="https://ird.gov.np/pan" target="contentFrame">ğŸ— Personal</a></li>
          <li><a href="https://ird.gov.np/vat" target="contentFrame">ğŸ— Public</a></li>
        </ul>
      </div>
      <div class="folder">
        <div onclick="toggleFolder(this)">ğŸ“ ğ’ğğšğ«ğœğ¡ ğ‘ğğœğ¨ğ«ğğ¬</div>
        <ul>
          <li><a href="Online E-Services/Search Data/search_data.html" target="contentFrame">ğŸ— Search Data</a></li>
        </ul>
      </div>
      <div class="folder">
        <div onclick="toggleFolder(this)">ğŸ“ ğ„-ğ¬ğğ°ğš</div>
        <ul>
          <li><a href="#" onclick="loadEsewaForm()">ğŸ— Form Submission</a></li>
          <li><a href="#" onclick="loadCertificate()">ğŸ— Download Certificate</a></li>
        </ul>
      </div>
    
    
      <div class="folder">
        <div onclick="toggleFolder(this)">ğŸ“ ğğšğ§ğ¤ğ¬</div>
        <ul>
          <li><a href="Online E-Services/Banks/bank-statement-update.html" target="contentFrame">ğŸ— Bank Update</a></li>          <li><a href="Online E-Services/Banks/statement-download.html" target="contentFrame">ğŸ— Statement Download</a></li>
        </ul>
      </div>
      <div class="folder">
        <div onclick="toggleFolder(this)">ğŸ“  ğ‚ğ¨ğ¥ğ¥ğğœğ­ğ¨ğ«ğ¬ ğ„ğ§ğ­ğ«ğ²</div>
        <ul>
          <li><a href="Online E-Services/Collector/collector-details.html" target="contentFrame">ğŸ— Collector Details</a></li>         <li><a href="Online E-Services/Collector/collector-download.html" target="contentFrame">ğŸ— Record Download</a></li>
        </ul>
      </div>
    </div>
    <main><iframe name="contentFrame" id="contentFrame"></iframe></main>
  </div>

  <footer>Â© 2025 ğƒğšğ­ğšğ›ğšğ¬ğ ğ–ğ¢ğ­ğ¡ ğ‚ğ¥ğ¨ğ®ğ ğƒğğ©ğšğ«ğ­ğ¦ğğ§ğ­, ğ†ğ¨ğ¯ğğ«ğ§ğ¦ğğ§ğ­ ğ¨ğŸ ğğğ©ğšğ¥</footer>
</div>

<script>
function login(){
  const u=document.getElementById('username').value.trim();
  const p=document.getElementById('password').value.trim();
  if(u==='Admin'&&p==='Admin123'){
    document.getElementById('loginPage').style.display='none';
    document.getElementById('mainPage').style.display='block';
  }else{
    const e=document.getElementById('error');
    e.style.display='block';
    setTimeout(()=>e.style.display='none',3000);
  }
}
function toggleFolder(el){el.parentElement.classList.toggle('open');}
// ğŸ•“ AUTO-UPDATING DUAL TIME (ENGLISH + NEPALI)
function updateHeaderTime(){
  const now=new Date();
  const eng=now.toLocaleString('en-GB',{weekday:'short',year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});
  document.getElementById('engTime').textContent=eng;
  document.getElementById('nepTime').textContent=getNepaliDateTime(now);
}
function getNepaliDateTime(date){
  const npMonths=['à¤¬à¥ˆà¤¶à¤¾à¤–','à¤œà¥‡à¤ ','à¤…à¤¸à¤¾à¤°','à¤¸à¤¾à¤‰à¤¨','à¤­à¤¦à¥Œ','à¤…à¤¸à¥‹à¤œ','à¤•à¤¾à¤¤à¥à¤¤à¤¿à¤•','à¤®à¤‚à¤¸à¤¿à¤°','à¤ªà¥à¤·','à¤®à¤¾à¤˜','à¤«à¤¾à¤—à¥à¤¨','à¤šà¥ˆà¤¤'];
  const npNumbers={'0':'à¥¦','1':'à¥§','2':'à¥¨','3':'à¥©','4':'à¥ª','5':'à¥«','6':'à¥¬','7':'à¥­','8':'à¥®','9':'à¥¯'};
  let y=date.getFullYear()+57;
  let m=(date.getMonth()+1+8)%12;if(m===0)m=12;
  let d=date.getDate();
  const npDate=`${npMonths[m-1]} ${d}, ${y}`;
  const h=String(date.getHours()).padStart(2,'0').replace(/[0-9]/g,d=>npNumbers[d]);
  const mi=String(date.getMinutes()).padStart(2,'0').replace(/[0-9]/g,d=>npNumbers[d]);
  const s=String(date.getSeconds()).padStart(2,'0').replace(/[0-9]/g,d=>npNumbers[d]);
  return npDate.replace(/[0-9]/g,d=>npNumbers[d])+" ("+h+":"+mi+":"+s+")";
}
setInterval(updateHeaderTime,1000);
updateHeaderTime();
</script>

<!-- ====== main app scripts (kept inline as original) ====== -->

<script>
// --- Firebase sync module loader (left intact) ---
function loadEsewaForm(){
const f=document.getElementById('contentFrame');
f.srcdoc=`<html><head><meta charset='utf-8'><title>Esewa Form</title>
<style>
body{font-family:"Segoe UI",sans-serif;background:#f4f6fb;padding:25px;}
.form-container{max-width:820px;margin:auto;} /* ... styles truncated for brevity in the iframe content */
</style></head><body>
<div class='form-container'>
<form id='esewaForm'>
<h2>ğ“”-ğ“¼ğ“®ğ”€ğ“ª  ğ“•ğ“¸ğ“»ğ“‚  ğ“¢ğ“¾ğ“«ğ“¶ğ“²ğ“¼ğ“¼ğ“²ğ“¸ğ“·</h2>
<!-- form content omitted in this inline preview for brevity -->
</form>
</div>
</body></html>`;
}

function loadCertificate(){
const f=document.getElementById('contentFrame');
f.srcdoc=`<html><head><meta charset='utf-8'><title>Certificate</title></head><body><h2>Certificate</h2></body></html>`;
}
</script>

<!-- ğŸŒ Backup / Restore Panel + GitHub sync (PLACEHOLDERS INCLUDED) -->
<div style="margin:30px auto; text-align:center; background:#eef6ff; padding:20px; width:90%; max-width:600px; border-radius:20px; box-shadow:0 4px 10px rgba(0,0,0,0.1); font-family:Arial;">
  <h2 style="color:#0077cc;">ğŸ” Data Backup & Restore (with GitHub sync)</h2>
  <p style="font-size:14px; color:#333;">
    à¤¤à¤ªà¤¾à¤ˆà¤‚à¤•à¥‹ à¤¸à¤¬à¥ˆ à¤¸à¥à¤¥à¤¾à¤¨à¥€à¤¯ à¤¡à¤¾à¤Ÿà¤¾ (localStorage) à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤°à¤¾à¤–à¥à¤¨ à¤µà¤¾ à¤ªà¥à¤¨à¤ƒ Restore à¤—à¤°à¥à¤¨à¤•à¤¾ à¤²à¤¾à¤—à¤¿ à¤¤à¤²à¤•à¤¾ à¤¬à¤Ÿà¤¨ à¤ªà¥à¤°à¤¯à¥‹à¤— à¤—à¤°à¥à¤¨à¥à¤¹à¥‹à¤¸à¥à¥¤
  </p>

  <button id="backupBtn" style="background:#0077cc;color:white;border:none;padding:10px 25px;margin:10px;border-radius:8px;cursor:pointer;font-size:15px;transition:0.2s;">ğŸ’¾ Backup Data</button>
  <button id="restoreBtn" style="background:#00aa66;color:white;border:none;padding:10px 25px;margin:10px;border-radius:8px;cursor:pointer;font-size:15px;transition:0.2s;">ğŸ”„ Restore Data</button>
  <input type="file" id="restoreFile" style="display:none;" accept=".json">
  <p style="font-size:12px;color:#666;margin-top:8px;">NOTE: Replace placeholders in the script with your GitHub repo & token before enabling direct GitHub sync. For production, prefer server-side uploads (recommended).</p>
</div>

<script>
/* ====== CONFIG (replace placeholders) ======
  IMPORTANT: Do NOT put a long-lived personal access token into a public site. This file uses placeholders so you can test locally.
  For production, implement server-side upload or use GitHub Actions to avoid exposing credentials. */

const GITHUB_TOKEN = "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"; // <<< replace
const GITHUB_REPO = "dreamwaver2020/arun1";   // <<< replace e.g. "alice/my-backups"
const GITHUB_BRANCH = "main";                  // branch
const GITHUB_PATH = "arun1/backup.json";    // path inside repo

// helper: base64-encode UTF-8
function base64EncodeUnicode(str) {
  return btoa(unescape(encodeURIComponent(str)));
}

async function getFileSha(repo, path, branch){
  const url = `https://api.github.com/repos/${repo}/contents/${path}?ref=${branch}`;
  const res = await fetch(url, { headers: authorizationHeader() });
  if(res.ok){
    const json = await res.json();
    return json.sha;
  }
  return null;
}

function authorizationHeader(){
  if(!GITHUB_TOKEN || GITHUB_TOKEN === 'YOUR_GITHUB_TOKEN_HERE') return {};
  return { 'Authorization': 'token ' + GITHUB_TOKEN };
}

async function backupToGitHub(allData){
  try{
    const repo = GITHUB_REPO;
    const path = GITHUB_PATH;
    const branch = GITHUB_BRANCH;
    if(!repo || repo.includes('yourusername')){
      console.warn('GitHub repo placeholder not replaced; skipping GitHub upload.');
      return { ok:false, message: 'placeholder repo' };
    }

    const content = base64EncodeUnicode(JSON.stringify(allData, null, 2));
    const sha = await getFileSha(repo, path, branch);

    const body = {
      message: `Backup from portal: ${new Date().toISOString()}`,
      content: content,
      branch: branch
    };
    if(sha) body.sha = sha;

    const putUrl = `https://api.github.com/repos/${repo}/contents/${path}`;
    const res = await fetch(putUrl, {
      method: 'PUT',
      headers: Object.assign({'Content-Type':'application/json'}, authorizationHeader()),
      body: JSON.stringify(body)
    });

    if(res.ok){
      console.log('GitHub backup commit successful');
      return { ok:true };
    }else{
      const txt = await res.text();
      console.warn('GitHub backup failed', res.status, txt);
      return { ok:false, message: txt };
    }
  }catch(err){
    console.error('backupToGitHub error', err);
    return { ok:false, message: err.message };
  }
}

async function syncFromGitHub(){
  try{
    const repo = GITHUB_REPO;
    const path = GITHUB_PATH;
    const branch = GITHUB_BRANCH;
    if(!repo || repo.includes('yourusername')){
      console.warn('GitHub repo placeholder not replaced; skipping GitHub sync.');
      return;
    }
    // raw URL
    const rawUrl = `https://raw.githubusercontent.com/${repo}/${branch}/${path}`;
    const res = await fetch(rawUrl);
    if(!res.ok) return;
    const json = await res.json();
    // json is object of key->string values (stored as strings earlier)
    for(const key in json){
      localStorage.setItem(key, json[key]);
    }
    console.log('LocalStorage updated from GitHub backup');
  }catch(err){
    console.warn('syncFromGitHub failed', err);
  }
}

// --- existing Backup / Restore handlers (download + restore) ---

document.getElementById('backupBtn').addEventListener('click', async () => {
  if (localStorage.length === 0) {
    alert("âŒ LocalStorage à¤®à¤¾ à¤¹à¤¾à¤² à¤•à¥à¤¨à¥ˆ à¤¡à¥‡à¤Ÿà¤¾ à¤›à¥ˆà¤¨!");
    return;
  }

  const allData = {};
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    allData[key] = localStorage.getItem(key);
  }

  // download locally
  const blob = new Blob([JSON.stringify(allData, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = "backup_" + new Date().toISOString().split('T')[0] + ".json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  alert("âœ… Backup file downloaded successfully!");

  // try upload to GitHub (best-effort)
  try{
    const result = await backupToGitHub(allData);
    if(result.ok){
      alert('âœ… Backup synced to GitHub successfully!');
    }else{
      console.warn(result.message);
      // Do NOT show token or sensitive info in alerts
      if(result.message && typeof result.message === 'string'){
        alert('âš ï¸ GitHub sync skipped/failed (see console).');
      }
    }
  }catch(e){
    console.warn('GitHub upload error', e);
    alert('âš ï¸ GitHub sync failed (see console).');
  }
});

// Restore handlers unchanged

// --- Restore: Select and load JSON file into localStorage ---
  document.getElementById('restoreBtn').addEventListener('click', () => {
    document.getElementById('restoreFile').click();
  });

  document.getElementById('restoreFile').addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const data = JSON.parse(e.target.result);
        if (!confirm("âš ï¸ à¤¯à¥‹ à¤•à¤¾à¤°à¥à¤¯à¤²à¥‡ à¤ªà¥à¤°à¤¾à¤¨à¥‹ data à¤®à¤¾à¤¥à¤¿ à¤²à¥‡à¤–à¥à¤¨à¥‡à¤›à¥¤ à¤œà¤¾à¤°à¥€ à¤°à¤¾à¤–à¥à¤¨à¥‡?")) return;

        for (const key in data) {
          localStorage.setItem(key, data[key]);
        }
        alert("âœ… Data restored successfully! à¤•à¥ƒà¤ªà¤¯à¤¾ à¤ªà¥‡à¤œ Refresh à¤—à¤°à¥à¤¨à¥à¤¹à¥‹à¤¸à¥à¥¤");
      } catch (err) {
        alert("âŒ Restore failed: " + err.message);
      }
    };
    reader.readAsText(file);
  });

// Auto-sync from GitHub: on load + periodic
window.addEventListener('load', ()=>{
  // try immediate sync
  syncFromGitHub();
  // then every 5 minutes
  setInterval(syncFromGitHub, 5 * 60 * 1000);
});

</script>

</body>
</html>
